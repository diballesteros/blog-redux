[{"_1":2},"routes/$slug",{"_3":4},"data",{"_5":6,"_27":28},"post",{"_7":8,"_9":10,"_11":12,"_13":14,"_15":16,"_19":20,"_21":22,"_23":24,"_25":26},"slug","how-to-add-cypress-codecov-in-github-actions-in-react-app","title","How to add Cypress & Codecov in Github Actions in React App","date","","description","How to easily integrate Cypress and Codecov in a React app in a CI/CD pipeline using Github Actions. Validate tests for free on open source apps in Github.","categories",[17,18],"testing","react","coverImage","https://cdn.hashnode.com/res/hashnode/image/upload/v1638468811165/SCsuy83xe2.png","published",true,"readingTime",4,"content","\r\n### Introduction\r\n\r\nHaving a thorough CI/CD pipeline for an application is critical to the success of the application. Typically in these same pipelines, it is normal to include a testing pipeline to make sure everything is still working correctly.\r\n\r\n[Cypress](https://www.cypress.io/) is a popular E2E testing framework with a robust system to truly test out the user experience. Whilst [Codecov](https://about.codecov.io/) is a development cycle tool to check out how much of the code is actually being¬†tested.\r\n\r\nUsing both of these tools in tandem can give useful feedback, especially if incorporated into the CI/CD pipelines!\r\n\r\n### Requirements\r\n\r\n-   Basic knowledge of Github¬†Actions\r\n-   Some Cypress tests have already been implemented\r\n-   React app ready to go and on Github as a repo! (Built with Create React¬†App)\r\n\r\n### Instrumentation\r\n\r\nCodecov must receive a code coverage report. This code coverage report can be created via instrumenting the testing tools. If your React App happened to be created via Create-React-App then this can be easily done with a package: [@cypress/instrument-cra](https://www.npmjs.com/package/@cypress/instrument-cra). This will automatically instrument your app when executing the tests, but we need to modify our **package.json**\r\n\r\nFirst, let‚Äôs install the necessary dependencies:\r\n\r\n```\r\nyarn add @cypress/code-coverage @cypress/instrument-cra --dev\r\n```\r\n\r\nThese two packages allow us to create and instrument our React¬†app.\r\n\r\nIn scripts let‚Äôs add two commands:\r\n\r\n```\r\n\"scripts\":\r\n    {\r\n        // ...Other commands\r\n        \"local:instrument\": \"react-scripts -r @cypress/instrument-cra start\",\r\n        \"ci:instrument\": \"CHOKIDAR\\_USEPOLLING=1 react-scripts -r @cypress/instrument-\r\n          cra start\",\r\n     },\r\n```\r\n\r\nThe first command is to instrument it locally to check out a coverage report locally, the second command will be the build command for the CI pipeline in Github¬†Actions.\r\n\r\nIf you use the local command and begin to use the app a report is generated in the coverage folder at the root of the¬†app:\r\n\r\n![Results](https://cdn.hashnode.com/res/hashnode/image/upload/v1638468811165/SCsuy83xe2.png)\r\n\r\nI recommend adding this new folder to the¬†**.gitignore**\r\n\r\nIf you need to exclude any files from the instrumentation this can be done in the package.json:\r\n\r\n```\r\n\"nyc\": {\r\n    \"exclude\": \\\r\n       [ \"src/serviceWorker.ts\", \"src/serviceWorkerRegistration.ts\", \\]\r\n },\r\n```\r\n\r\nI‚Äôm personally excluding files associated with the service¬†worker.\r\n\r\n### Codecov and¬†Cypress\r\n\r\nLet‚Äôs get Codecov and Cypress integrated with our Github repo. Navigate to the following two¬†pages:\r\n\r\nLogin, integrate, and give permissions to the respective Github Repo. Take into account that if it is not open source this will require¬†paying.\r\n\r\nCypress Dashboard has a limit for tests per¬†month.\r\n\r\n### The pipeline\r\n\r\nNow that our integrations are connected we need to create the respective pipelines in Github Actions. Let's create a¬†**.github** folder in the root of our folder with an internal folder named **workflows**. Inside let's create one more file named¬†**main.yml**\r\n\r\nYou can find the full example of the file¬†here:\r\n\r\n[https://github.com/diballesteros/nuzlocke/blob/master/.github/workflows/main.yml](https://github.com/diballesteros/nuzlocke/blob/master/.github/workflows/main.yml)\r\n\r\nThis can essentially be copied and pasted making sure the commands exist and are¬†correct.\r\n\r\nI‚Äôll explain a few of the important parts:\r\n\r\n### Building the¬†Artifact\r\n\r\nsteps: - name: Checkout uses: actions/checkout@v2 - name: Cypress install uses: cypress-io/github-action@v2.9.7 with: runTests: false # report machine parameters - run: yarn cypress info - run: node -p 'os.cpus()' - run: yarn lint - run: yarn build - name: Save build folder uses: actions/upload-artifact@v2 with: name: build if-no-files-found: error path: build\r\n\r\nI want to run the tests on several browsers so I‚Äôll first create a step to create an artifact of the build folder to share with the other parallelizations. I validate some of the specs and the cypress¬†version.\r\n\r\n### Running the tests and uploading\r\n\r\nAfterward, I‚Äôll run the tests in every container:\r\n\r\n```yml\r\nsteps:\r\n    - name: üõ´ Checkout\r\n      uses: actions/checkout@v2\r\n\r\n    - name: üèó Download the build folders\r\n      uses: actions/download-artifact@v2\r\n      with:\r\n          name: build\r\n          path: build\r\n\r\n    - name: üíª 'UI Tests - Chrome'\r\n      uses: cypress-io/github-action@v2.9.7\r\n      with:\r\n          start: yarn run develop:ci\r\n          wait-on: http://localhost:3000\r\n          wait-on-timeout: 120\r\n          browser: chrome\r\n          record: true\r\n          parallel: true\r\n          group: 'UI - Chrome - Main'\r\n          spec: 'cypress/integration/main/*'\r\n      env:\r\n          CYPRESS_PROJECT_ID: ${{ secrets.CYPRESS_PROJECT_ID }}\r\n          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}\r\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\r\n\r\n    - name: ‚úÖ Upload coverage to Codecov\r\n      uses: codecov/codecov-action@v2\r\n```\r\n\r\nThe most important portion here is using the already pre-existing GitHub action for cypress with **cypress-io/github-action@v2.9.7**\r\n\r\nAlso, I‚Äôm using the command previously **ci:instrument **to run the build. Likewise, I have included the tokens to integrate the Cypress dashboard. If your repository is private you **must** also include a token for¬†Codecov.\r\n\r\nThe final portion Upload coverage to Codecov automatically uploads the report to Codecov if the Github integration is in¬†place.\r\n\r\n```yml\r\nname: Cypress on: \\[push\\] jobs:\r\n```\r\n\r\nDon‚Äôt forget that you can customize what actions the workflow will trigger. I have it here for every¬†push.\r\n\r\n### Example of¬†results\r\n\r\nNow with a push, you‚Äôll be able to see the workflow being executed in the Actions tab of the respective repo:\r\n\r\n![codecov](https://cdn.hashnode.com/res/hashnode/image/upload/v1638468814578/mopJg0qnF.png)\r\n\r\nAnd in the respective pull requests you can see the¬†reports:\r\n\r\n![codecov](https://cdn.hashnode.com/res/hashnode/image/upload/v1638468817497/KfzDlX8xX.png)\r\n\r\n![codecov](https://cdn.hashnode.com/res/hashnode/image/upload/v1638468820541/J_3lePcyd.png)\r\n","recommendations",[29,36,43,49],{"_7":30,"_9":31,"_11":12,"_13":32,"_15":33,"_19":35,"_21":22,"_23":24},"what-is-imposter-syndrome-and-how-i-deal-with-it","What is imposter syndrome? And how I deal with it","Imposter syndrome is a common feeling to have as a software developer even if you've been doing it for years. I go over my personal experiences with it.",[34],"devlog","https://cdn.hashnode.com/res/hashnode/image/upload/v1651102112425/KKsbnfbCK.png",{"_7":37,"_9":38,"_11":12,"_13":39,"_15":40,"_19":41,"_21":22,"_23":42},"testing-a-reaction-application-updating-to-cypress-version-10","Testing a Reaction Application updating to Cypress Version 10","Testing a modern React application. In this part of the series, we go over how to update Cypress to version 10.",[17,18],"https://cdn.hashnode.com/res/hashnode/image/upload/v1651098470347/9coA_akWr.png",3,{"_7":44,"_9":45,"_11":12,"_13":46,"_15":47,"_19":41,"_21":22,"_23":48},"testing-a-react-application-working-with-codecov","Testing a React Application Working with Codecov","How to test a React web application and upload the test code coverage results to Codecov.",[17,18],5,{"_7":50,"_9":51,"_11":12,"_13":52,"_15":53,"_19":41,"_21":22,"_23":24},"testing-a-react-application-what-is-vitest","Testing a React Application What is Vitest?","The third part of a series of articles on how to test a React Application. I go over how Vitest and its syntax work in the simplest terms.",[17,18]]
