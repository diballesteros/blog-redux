[{"_1":2},"routes/$slug",{"_3":4},"data",{"_5":6,"_26":27},"post",{"_7":8,"_9":10,"_11":12,"_13":14,"_15":16,"_18":19,"_20":21,"_22":23,"_24":25},"slug","how-to-migrate-create-react-app-to-react-version-18","title","How to migrate Create-React-App to React version 18","date","","description","My experience migrating my Create-React-App (CRA) to React Version 18. How to deal with the breaking changes and handle errors (Typescript included).","categories",[17],"react","coverImage","https://cdn.hashnode.com/res/hashnode/image/upload/v1651101564070/9KD0sNeg2.png","published",true,"readingTime",5,"content","\r\n### Introduction\r\n\r\nReact just recently came out with a new version of their library: React version 18. I have a few apps that Iâ€™ve been maintaining for a while now that weâ€™re bootstrapped with Create-React-App. Iâ€™ll go over how to migrate to version 18 and the issues I ran into along the way.\r\n\r\n[Here](https://reactjs.org/blog/2022/03/29/react-v18.html) you can find the list of changes for React 18.\r\n\r\nI also have a small write-up for my thoughts on it [here](https://relatablecode.substack.com/p/react-18-finally-out-and-new-css?s=w).\r\n\r\n### Create-React-App migration to React version 18\r\n\r\nThe actual process of migrating is pretty quick. Letâ€™s install the necessary dependencies:\r\n\r\n```bash\r\nyarn add react react-dom\r\n```\r\n\r\nThe team behind create-react-app also came out with version 5.0.1 to help the migration process and make any new apps come with it out of the box:\r\n\r\n```bash\r\nnpm install --save --save-exact react-scripts@5.0.1\r\n\r\nor\r\n\r\nyarn add --exact react-scripts@5.0.1\r\n```\r\n\r\nIf youâ€™re using Typescript donâ€™t forget to update your types not only for React but for different **third-party** libraries. A lot have updated their apps.\r\n\r\n```bash\r\nyarn add @types/react @types/react-dom @types/node --dev\r\n```\r\n\r\n### Mandatory changes\r\n\r\nThe first thing we have to do is change how our root node is being rendered by React. The _first_ code block is how it originally looks.\r\n\r\n```ts\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n```\r\n\r\nNow weâ€™re going to use the newly added **createRoot** function:\r\n\r\n```ts\r\nimport { createRoot } from 'react-dom/client';\r\nimport App from './App';\r\n\r\nconst container = document.getElementById('root');\r\nconst root = createRoot(container);\r\n\r\nroot.render(<App />);\r\n```\r\n\r\n### Create-React-App migration to React version 18: Typescript\r\n\r\nIf you donâ€™t use Typescript you can skip this portion.\r\n\r\nFirst, letâ€™s check out how many errors we have to deal with. This will vary from project to project depending on how many incompatible third-party libraries you may have but theyâ€™ll all be resolved in a similar fashion.\r\n\r\nRun the following command:\r\n\r\nOuch, we got 36 errors to resolve. Luckily most of them are the same.\r\n\r\n![36 errors](https://cdn.hashnode.com/res/hashnode/image/upload/v1650545183141/vH6y2WEth.png)\r\n\r\nI use [Semantic UI](https://react.semantic-ui.com/) in this project and there were several errors with the UI Radio component. For example, I had a **setView** function that took in the parameters from the **onChange** prop. For some reason, I lost the typing on the **e** and **data** parameters.\r\n\r\n```js\r\nParameter 'data' implicitly has an 'any' type. onChange={(e, data) => setView(data.value as number)}\r\n```\r\n\r\nI hit **F12** (Windows users) or right-clicking and heading to the Type definition. On the prop of onChange to check out what it should be returning and manually set the types to the function.\r\n\r\n![types](https://cdn.hashnode.com/res/hashnode/image/upload/v1650545184206/NoxDQwg6_.png)\r\n\r\nMake sure to import the type from the library and set the types inside the function itself.\r\n\r\n```ts\r\nimport type { CheckboxProps } from 'semantic-ui-react';\r\n\r\n\r\n<Radio\r\n// other props\r\nonChange={(e: React.FormEvent<HTMLInputElement>, data: CheckboxProps) => { // whatever your function does } }\r\n/>\r\n```\r\n\r\n### Create-React-App migration to React version 18: Sentry\r\n\r\nI also use the Sentry library to track errors in my project. [Hereâ€™s a quick write-up](https://relatablecode.com/how-to-quickly-add-error-tracking-with-sentry/) on how that works. For sentry, I got some errors with the ErrorBoundary component. This will probably be patched up but we can do it ahead of time until then.\r\n\r\nReact version 18 requires children to be explicitly declared in the props, hence the error:\r\n\r\n```bash\r\nerror TS2769: No overload matches this call. Overload 1 of 2,\r\n'(props: ErrorBoundaryProps | Readonly<ErrorBoundaryProps>): ErrorBoundary', gave the following error.\r\n```\r\n\r\nThankfully, thereâ€™s a library called patch-package that allows us to fix this up. Letâ€™s install it.\r\n\r\n```bash\r\nyarn add patch-package --dev\r\n```\r\n\r\nAs before letâ€™s check out the type definitions for the ErrorBoundary by stepping into it. Hitting F12 or right-clicking and going to the Type definition.\r\n\r\n![type definition](https://cdn.hashnode.com/res/hashnode/image/upload/v1650545185359/dA41Qj7wS.png)\r\n\r\nAs suspected the type does not have the children prop. Letâ€™s add it by setting it to a **React.ReactNode**.\r\n\r\n```ts\r\nexport declare type ErrorBoundaryProps = {\r\nchildren: React.ReactNode;\r\n //...rest of the type, just ignore it\r\n```\r\n\r\nIn order for **patch-package** to recognize this change we should run the following command in our terminal:\r\n\r\n```bash\r\nnpx patch-package @sentry/react\r\n```\r\n\r\nThis will create a file in our project indicating the changes we patched in the library.\r\n\r\n```json\r\ndiff --git a/node_modules/@sentry/react/types/errorboundary.d.ts b/node_modules/@sentry/react/types/errorboundary.d.ts\r\nindex 4e1f326..779e0e7 100644\r\n--- a/node_modules/@sentry/react/types/errorboundary.d.ts\r\n+++ b/node_modules/@sentry/react/types/errorboundary.d.ts\r\n@@ -9,6 +9,7 @@ export declare type FallbackRender = (errorData: {\r\n resetError(): void;\r\n }) => React.ReactElement; export declare type ErrorBoundaryProps = {\r\n+ children: React.ReactNode;\r\n/ **If a Sentry report dialog should be rendered on error */ showDialog?: boolean;\r\n/**\r\n```\r\n\r\nThe final step is to add the following line to our **scripts** in our **package.json**.\r\n\r\n```json\r\n\"scripts\": {\r\n // ...other scripts\r\n\"postinstall\": \"patch-package\"\r\n}\r\n```\r\n\r\n### Sidenote\r\n\r\nAs a small aside if there are any libraries you donâ€™t want to patch and just want to ignore the errors for the time being while the maintainers fix them up. (Or alternatively, you can open up a PR to fix it! ðŸ˜¬) Just add some ts-ignore to the file right before the error:\r\n\r\n### Wrapping it up\r\n\r\nCreate-React-App is still the most widely used method to bootstrap React apps so being able to migrate it is pretty important for some users. ðŸš€\r\n\r\nIf you liked this check out other posts like this at [Relatable Code](https://relatablecode.com)\r\n\r\nIf you liked this feel free to connect with me on [LinkedIn](https://www.linkedin.com/in/relatablecode) or [Twitter](https://twitter.com/relatablecoder)\r\n\r\nCheck out my free developer roadmap and weekly tech industry news in my [newsletter](https://relatablecode.substack.com/).\r\n","recommendations",[28,36,44,49],{"_7":29,"_9":30,"_11":12,"_13":31,"_15":32,"_18":34,"_20":21,"_22":35},"what-is-imposter-syndrome-and-how-i-deal-with-it","What is imposter syndrome? And how I deal with it","Imposter syndrome is a common feeling to have as a software developer even if you've been doing it for years. I go over my personal experiences with it.",[33],"devlog","https://cdn.hashnode.com/res/hashnode/image/upload/v1651102112425/KKsbnfbCK.png",4,{"_7":37,"_9":38,"_11":12,"_13":39,"_15":40,"_18":42,"_20":21,"_22":43},"testing-a-reaction-application-updating-to-cypress-version-10","Testing a Reaction Application updating to Cypress Version 10","Testing a modern React application. In this part of the series, we go over how to update Cypress to version 10.",[41,17],"testing","https://cdn.hashnode.com/res/hashnode/image/upload/v1651098470347/9coA_akWr.png",3,{"_7":45,"_9":46,"_11":12,"_13":47,"_15":48,"_18":42,"_20":21,"_22":23},"testing-a-react-application-working-with-codecov","Testing a React Application Working with Codecov","How to test a React web application and upload the test code coverage results to Codecov.",[41,17],{"_7":50,"_9":51,"_11":12,"_13":52,"_15":53,"_18":42,"_20":21,"_22":35},"testing-a-react-application-what-is-vitest","Testing a React Application What is Vitest?","The third part of a series of articles on how to test a React Application. I go over how Vitest and its syntax work in the simplest terms.",[41,17]]
