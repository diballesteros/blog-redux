[{"_1":2},"routes/$slug",{"_3":4},"data",{"_5":6,"_27":28},"post",{"_7":8,"_9":10,"_11":12,"_13":14,"_15":16,"_19":20,"_21":22,"_23":24,"_25":26},"slug","testing-a-react-application-instrumenting-our-codebase","title","Testing a React Application Instrumenting our codebase","date","","description","Testing a React application. How to instrument a React web application codebase with Istanbul.","categories",[17,18],"testing","react","coverImage","https://cdn.hashnode.com/res/hashnode/image/upload/v1651098470347/9coA_akWr.png","published",true,"readingTime",4,"content","\r\n### Introduction\r\n\r\nIn the previous article, we went over how to update Cypress to its amazing version 10! Now we'll finish off this series by adding code coverage to our application and incorporating it into our CI. But what is code coverage?\r\n\r\n> Code coverage is a software testing metric that determines the number of lines of code that is successfully validated under a test procedure, which in turn, helps in analyzing how comprehensively a software is verified.\r\n> [Source](https://www.codegrip.tech/productivity/everything-you-need-to-know-about-code-coverage/)\r\n\r\nIn most cases, this is a percentage of how much the codebase is being covered by tests. How do we know if a test covers a certain amount of code? Instrumentation of our code monitors and traces the test coverage and gives us accurate reports.\r\n\r\nCool! First, let's go over what our application does. When clicking on a button it fetches posts from a service and displays them on the page:\r\n\r\n![react application](https://cdn.hashnode.com/res/hashnode/image/upload/v1655731646357/xXQbRLpDs.png align=\"left\")\r\n\r\nFor reference, you can find the repository [here](https://github.com/diballesteros/react-testing).\r\n\r\n### Installing codecov\r\n\r\nWe will be using [Codecov](https://about.codecov.io/)\r\n\r\n> Ship healthier code faster with less risk.\r\n\r\nThat's their motto! But how do we go about using it? In the link above make sure to make an account and connect your repository.\r\n\r\n![Codecov post login](https://cdn.hashnode.com/res/hashnode/image/upload/v1655734042801/_IMPx_Ob9.png align=\"left\")\r\n\r\nIn the `Not yet setup` tab we should find our repository.\r\n\r\n![React testing not yet setup](https://cdn.hashnode.com/res/hashnode/image/upload/v1655734102742/nnsUU6ZD0.png align=\"left\")\r\n\r\nThis will give us some brief instructions on how to set up code coverage with our repository. First, let's install a necessary Cypress package:\r\n\r\n```bash\r\nnpm install @cypress/code-coverage --save-dev\r\n```\r\n\r\nThen in our `cypress/support/e2e.js` file let's go ahead and import this new code.\r\n\r\n```js\r\nimport './commands';\r\n\r\nimport '@cypress/code-coverage/support';\r\n```\r\n\r\nIn our `cypress.config.js` we also have to set up the events to correctly execute the code coverage:\r\n\r\n```js\r\nconst { defineConfig } = require('cypress');\r\n\r\nmodule.exports = defineConfig({\r\n\te2e: {\r\n\t\tbaseUrl: 'http://localhost:3000',\r\n\t\tspecPattern: 'cypress/integration/**/*.spec.js',\r\n\t\tsetupNodeEvents(on, config) {\r\n\t\t\trequire('@cypress/code-coverage/task')(on, config);\r\n\t\t\treturn config;\r\n\t\t},\r\n\t},\r\n});\r\n```\r\n\r\nLet's open up our application and cypress to run our test:\r\n\r\n```bash\r\nnpm run dev\r\n\r\nnpm run test-e2e\r\n```\r\n\r\nWhen we run our test we will see the following command:\r\n\r\n![Cypress missing instrumentation](https://cdn.hashnode.com/res/hashnode/image/upload/v1655763704039/KiDSbC7-g.png align=\"left\")\r\n\r\nWhat we're missing is the instrumentation for our code. There are a few ways to go about this. But first, let's add the two new folders to our `.gitignore`:\r\n\r\n```text\r\n# Code coverage files\r\ncoverage\r\n.nyc_output\r\n```\r\n\r\nTo instrument our code we have to install the following plugin:\r\n\r\n```bash\r\nnpm install vite-plugin-istanbul --save-dev\r\n```\r\n\r\nIn our `vite.config.js` we should import the newly installed library and set it up:\r\n\r\n```js\r\nimport { defineConfig } from 'vite';\r\nimport react from '@vitejs/plugin-react';\r\nimport istanbul from 'vite-plugin-istanbul';\r\n\r\n// https://vitejs.dev/config/\r\nexport default defineConfig({\r\n\tplugins: [\r\n\t\treact(),\r\n\t\tistanbul({\r\n\t\t\tinclude: 'src/*',\r\n\t\t\texclude: ['node_modules', 'cypress'],\r\n\t\t\textension: ['.js', '.jsx'],\r\n\t\t}),\r\n\t],\r\n\ttest: {\r\n\t\tglobals: true,\r\n\t\tenvironment: 'jsdom',\r\n\t\tsetupFiles: ['./src/setup.js'],\r\n\t},\r\n});\r\n```\r\n\r\nSome interesting notes on how the Istanbul plugin works can be found [here](https://github.com/iFaxity/vite-plugin-istanbul).\r\n\r\nFinally, when we run the rest we'll no longer see the same warning as before:\r\n\r\n![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1665324469322/40YutZqc0.png align=\"left\")\r\n\r\nTo get a better understanding of what's going on let's take a look at the root directory you'll see a folder, `coverage`:\r\n\r\n![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1665325037427/EvroOdgsf.png align=\"left\")\r\n\r\nYou'll see some `JSON` files that detail exactly what is covered in the files of the directory we provided earlier in the `vite.config.js` (`./src`).\r\n\r\n### Wrapping it up\r\n\r\nInstrumenting our code base is crucial to providing Codecov with the necessary information it needs to give us the percentage of code coverage we actually have.\r\n\r\nIn the next article, I'll go over how to set up the GitHub Action to automatically send the code coverage report to CodeCov with every push. This way you don't have to think about it at all!\r\n\r\nYou can find the full code here at this [repo](https://github.com/diballesteros/react-testing).\r\n\r\n### Let's connect\r\n\r\nIf you liked this feel free to connect with me on [LinkedIn](https://www.linkedin.com/in/relatablecode) or [Twitter](https://twitter.com/relatablecoder)\r\n\r\nCheck out my free developer roadmap and weekly tech industry news in my [newsletter](https://relatablecode.substack.com/).\r\n","recommendations",[29,36,42,48],{"_7":30,"_9":31,"_11":12,"_13":32,"_15":33,"_19":35,"_21":22,"_23":24},"what-is-imposter-syndrome-and-how-i-deal-with-it","What is imposter syndrome? And how I deal with it","Imposter syndrome is a common feeling to have as a software developer even if you've been doing it for years. I go over my personal experiences with it.",[34],"devlog","https://cdn.hashnode.com/res/hashnode/image/upload/v1651102112425/KKsbnfbCK.png",{"_7":37,"_9":38,"_11":12,"_13":39,"_15":40,"_19":20,"_21":22,"_23":41},"testing-a-reaction-application-updating-to-cypress-version-10","Testing a Reaction Application updating to Cypress Version 10","Testing a modern React application. In this part of the series, we go over how to update Cypress to version 10.",[17,18],3,{"_7":43,"_9":44,"_11":12,"_13":45,"_15":46,"_19":20,"_21":22,"_23":47},"testing-a-react-application-working-with-codecov","Testing a React Application Working with Codecov","How to test a React web application and upload the test code coverage results to Codecov.",[17,18],5,{"_7":49,"_9":50,"_11":12,"_13":51,"_15":52,"_19":20,"_21":22,"_23":24},"testing-a-react-application-what-is-vitest","Testing a React Application What is Vitest?","The third part of a series of articles on how to test a React Application. I go over how Vitest and its syntax work in the simplest terms.",[17,18]]
