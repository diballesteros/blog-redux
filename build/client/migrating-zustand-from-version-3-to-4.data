[{"_1":2},"routes/$slug",{"_3":4},"data",{"_5":6,"_26":27},"post",{"_7":8,"_9":10,"_11":12,"_13":14,"_15":16,"_18":19,"_20":21,"_22":23,"_24":25},"slug","migrating-zustand-from-version-3-to-4","title","Migrating Zustand from version 3 to 4","date","","description","In this article, I go over my experience on how I migrated Zustand from version 3 to 4 in a React web application using Typescript.","categories",[17],"react","coverImage","https://cdn.hashnode.com/res/hashnode/image/upload/v1664640672964/0VejIbQL2.png","published",true,"readingTime",3,"content","\r\n### Introduction\r\n\r\nZustand is an awesome state management library for React that excels in its simplicity. Its just one hook that can then be called from anywhere in the app to access your **store**.\r\n\r\nThis simplicity has made it the perfect choice for personal small-medium sized apps because it requires little boilerplate and it comes baked in with some awesome middleware!\r\n\r\nAs an aside middleware is:\r\n\r\nsuch as:\r\n\r\n-   Persisting to local storage\r\n-   Immer to make state changes easier to handle\r\n-   Store version and migration handling\r\n\r\nI used this library to handle persisted data in a personal app of [mine](https://nuzlocke.netlify.app/). Essentially its a CRUD app to manage Pokemon you run into in a playthrough of a game.\r\n\r\nThe important part however is that I have an **obsession** with keeping my libraries up-to-date (specifically in these small personal apps) so I decided to go ahead and migrate Zustand from version 3 to 4.\r\n\r\nAs a small disclaimer this article assumes you have some base level experience with Zustand.\r\n\r\n### Migration Process\r\n\r\nFirst and foremost you can check out the changelog and any specific changes you may need to do on the [Zustand GitHub repo changelog](https://github.com/pmndrs/zustand/releases).\r\n\r\nFirst, let's go ahead and update the library:\r\n\r\n```ts\r\nyarn add zustand\r\n```\r\n\r\nIn my case, it updated to `4.1.1`.\r\n\r\n![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1664710424756/byJ4fabwY.png)\r\n\r\nAll the previous APIs are backward compatible so keep in mind that the changes I'm going to make apply to Typescript.\r\n\r\n[Immer](https://immerjs.github.io/immer/) is a library that allows you to work with immutable state data in a more convenient way. Before we had to explicitly set the type like this and the function to use it:\r\n\r\n```ts\r\nconst immer =\r\n\t<T extends State>(config: StateCreator<T>): StateCreator<T> =>\r\n\t(set, get, api) =>\r\n\t\tconfig(\r\n\t\t\t(partial, replace) => {\r\n\t\t\t\tconst nextState =\r\n\t\t\t\t\ttypeof partial === 'function'\r\n\t\t\t\t\t\t? produce(partial as (state: T) => T)\r\n\t\t\t\t\t\t: (partial as T);\r\n\t\t\t\treturn set(nextState, replace);\r\n\t\t\t},\r\n\t\t\tget,\r\n\t\t\tapi\r\n\t\t);\r\n```\r\n\r\nHowever, we can now just import it directly from Zustand's middleware, so we can delete the above code.\r\n\r\n```ts\r\nimport { immer } from 'zustand/middleware/immer';\r\n```\r\n\r\nNext, the section where you're creating the store requires a small change:\r\n\r\n```ts\r\nconst useStore = create<AppState>(\r\n```\r\n\r\nto\r\n\r\n```ts\r\nconst useStore = create<AppState>()(\r\n```\r\n\r\nIt is now treated as a curried function.\r\n\r\nLast but not least, I used the `migrate` option in the `PersisOptions` that Zustand provides to persist all data to local storage. However, the state of this app is now considered `unknown` by Typescript.\r\n\r\nWe can fix this by explicitly declaring the type with an assert function. For the sake of brevity I did something like this:\r\n\r\n```ts\r\n migrate: (persistedState, version) => {\r\n      assertAppState(persistedState);\r\n```\r\n\r\nThe assert function looks something like this:\r\n\r\n```ts\r\nfunction assertAppState(val: unknown): asserts val is AppState {\r\n\tif (typeof val !== 'object') {\r\n\t\tthrow new TypeError('Invalid app state');\r\n\t}\r\n}\r\n```\r\n\r\nThis means anytime I call my state object afterward in the `migrate` function then it will have the correct typing rather than `unknown`.\r\n\r\n### Wrapping it up\r\n\r\nZustand is an awesome library that is simple to use. I recommend using it in any project you may be working on. If you have any other questions or stories about your migration process leave them in the comments below!\r\n\r\n### Let's connect\r\n\r\nIf you liked this feel free to connect with me on [LinkedIn](https://www.linkedin.com/in/relatablecode) or [Twitter](https://twitter.com/relatablecoder)\r\n\r\nCheck out my free developer roadmap and weekly tech industry news in my [newsletter](https://relatablecode.substack.com/).\r\n","recommendations",[28,36,43,49],{"_7":29,"_9":30,"_11":12,"_13":31,"_15":32,"_18":34,"_20":21,"_22":35},"what-is-imposter-syndrome-and-how-i-deal-with-it","What is imposter syndrome? And how I deal with it","Imposter syndrome is a common feeling to have as a software developer even if you've been doing it for years. I go over my personal experiences with it.",[33],"devlog","https://cdn.hashnode.com/res/hashnode/image/upload/v1651102112425/KKsbnfbCK.png",4,{"_7":37,"_9":38,"_11":12,"_13":39,"_15":40,"_18":42,"_20":21,"_22":23},"testing-a-reaction-application-updating-to-cypress-version-10","Testing a Reaction Application updating to Cypress Version 10","Testing a modern React application. In this part of the series, we go over how to update Cypress to version 10.",[41,17],"testing","https://cdn.hashnode.com/res/hashnode/image/upload/v1651098470347/9coA_akWr.png",{"_7":44,"_9":45,"_11":12,"_13":46,"_15":47,"_18":42,"_20":21,"_22":48},"testing-a-react-application-working-with-codecov","Testing a React Application Working with Codecov","How to test a React web application and upload the test code coverage results to Codecov.",[41,17],5,{"_7":50,"_9":51,"_11":12,"_13":52,"_15":53,"_18":42,"_20":21,"_22":35},"testing-a-react-application-what-is-vitest","Testing a React Application What is Vitest?","The third part of a series of articles on how to test a React Application. I go over how Vitest and its syntax work in the simplest terms.",[41,17]]
